# Vue 3

本库提供了开箱即用的 Vue 3 集成，包括 `SkinViewer` 组件和一系列组合式函数。

[Vue Playground](https://play.vuejs.org/#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)

## 安装

确保你的项目已安装 Vue 3，然后从 `vue3` 子路径导入：

```ts
import { SkinViewer, useSkinViewer } from "@daidr/minecraft-skin-renderer/vue3";
```

::: tip 注册渲染器插件
使用 3D 组件或组合式函数前需注册渲染器插件。推荐通过 `plugins` prop 传入（如 `:plugins="[WebGLRendererPlugin]"`），也可以在应用入口处调用 `use(WebGLRendererPlugin)` 全局注册——全局注册后所有组件无需再传 `plugins`。
:::

## SkinViewer 组件

`SkinViewer` 是一个 Props 驱动的 3D 皮肤查看器组件，渲染一个承载 WebGL/WebGPU 画布的容器 `div`。所有选项通过 props 控制，响应式同步到查看器实例。

### 基本用法

```vue
<script setup lang="ts">
import { SkinViewer } from "@daidr/minecraft-skin-renderer/vue3";
import { WebGLRendererPlugin } from "@daidr/minecraft-skin-renderer/webgl";

const skinUrl = "https://example.com/skin.png";
</script>

<template>
  <SkinViewer
    :plugins="[WebGLRendererPlugin]"
    :skin="skinUrl"
    animation="walk"
    style="width: 400px; height: 600px"
  />
</template>
```

### Props

| Prop                 | 类型                            | 默认值   | 说明                                                   |
| -------------------- | ------------------------------- | -------- | ------------------------------------------------------ |
| `plugins`            | `AnyRegistrablePlugin[]`        | —        | 自动注册的插件列表                                     |
| `skin`               | `TextureSource`                 | —        | 皮肤纹理（URL、Blob、HTMLImageElement 或 ImageBitmap） |
| `cape`               | `TextureSource \| null`         | —        | 披风纹理，`null` 隐藏披风                              |
| `slim`               | `boolean`                       | `false`  | 是否使用纤细（3px）手臂模型                            |
| `backEquipment`      | `'none' \| 'cape' \| 'elytra'`  | `'none'` | 背部装备                                               |
| `preferredBackend`   | `'webgl' \| 'webgpu' \| 'auto'` | `'auto'` | 首选渲染后端                                           |
| `zoom`               | `number`                        | —        | 相机缩放距离                                           |
| `autoRotate`         | `boolean`                       | `false`  | 启用自动旋转                                           |
| `autoRotateSpeed`    | `number`                        | —        | 自动旋转速度                                           |
| `enableRotate`       | `boolean`                       | `true`   | 启用鼠标旋转控制                                       |
| `enableZoom`         | `boolean`                       | `true`   | 启用鼠标缩放控制                                       |
| `animation`          | `string \| null`                | —        | 播放的动画名称，`null` 停止动画                        |
| `animationSpeed`     | `number`                        | `1`      | 动画播放速度倍率                                       |
| `animationAmplitude` | `number`                        | `1`      | 动画运动幅度倍率                                       |
| `partsVisibility`    | `PartsVisibility`               | —        | 各部位图层可见性                                       |
| `panorama`           | `TextureSource \| null`         | —        | 全景图背景（需要 PanoramaPlugin）                      |
| `pixelRatio`         | `number`                        | —        | 设备像素比覆盖                                         |
| `antialias`          | `boolean`                       | `true`   | 启用抗锯齿                                             |
| `fov`                | `number`                        | —        | 相机视场角（度）                                       |

### 事件

| 事件    | 参数                   | 说明                     |
| ------- | ---------------------- | ------------------------ |
| `ready` | `(viewer: SkinViewer)` | 查看器初始化完成时触发   |
| `error` | `(error: Error)`       | 初始化或运行时出错时触发 |

### 暴露方法

通过模板引用（template ref）访问：

```vue
<script setup lang="ts">
import { ref } from "vue";
import { SkinViewer } from "@daidr/minecraft-skin-renderer/vue3";

const viewerRef = ref<InstanceType<typeof SkinViewer>>();

function takeScreenshot() {
  const dataUrl = viewerRef.value?.screenshot("png");
  // ...
}
</script>

<template>
  <SkinViewer ref="viewerRef" :skin="skinUrl" />
</template>
```

| 方法         | 类型                                                           | 说明             |
| ------------ | -------------------------------------------------------------- | ---------------- |
| `viewer`     | `ShallowRef<SkinViewer \| null>`                               | 查看器实例       |
| `backend`    | `ComputedRef<BackendType \| null>`                             | 当前渲染后端     |
| `screenshot` | `(type?: 'png' \| 'jpeg', quality?: number) => string \| null` | 截图             |
| `recreate`   | `() => Promise<void>`                                          | 销毁并重建查看器 |

## useSkinViewer

底层组合式函数，用于手动管理 SkinViewer 实例的创建和生命周期。适合需要更细粒度控制的场景。

### 基本用法

```vue
<script setup lang="ts">
import { ref } from "vue";
import { useSkinViewer } from "@daidr/minecraft-skin-renderer/vue3";
import { WebGLRendererPlugin } from "@daidr/minecraft-skin-renderer/webgl";

const skinUrl = ref("https://example.com/skin.png");

const { containerRef, viewer, isReady, error } = useSkinViewer(() => ({
  plugins: [WebGLRendererPlugin],
  skin: skinUrl.value,
  animation: "walk",
}));
</script>

<template>
  <div ref="containerRef" style="width: 400px; height: 600px" />
</template>
```

### 选项

传入一个返回 `UseSkinViewerOptions` 的 getter 函数。动态选项（`skin`、`cape`、`slim`、`zoom`、`animation` 等）会被自动监听并同步到查看器。创建时选项（`preferredBackend`、`antialias`、`fov` 等）仅在初始化时应用，修改后需调用 `recreate()` 重新初始化。

### 返回值

| 属性           | 类型                                                           | 说明                     |
| -------------- | -------------------------------------------------------------- | ------------------------ |
| `containerRef` | `Ref<HTMLElement \| null>`                                     | 绑定到容器元素的模板引用 |
| `viewer`       | `ShallowRef<SkinViewer \| null>`                               | 查看器实例               |
| `backend`      | `ComputedRef<BackendType \| null>`                             | 当前渲染后端             |
| `isReady`      | `Ref<boolean>`                                                 | 查看器是否已初始化       |
| `error`        | `ShallowRef<Error \| null>`                                    | 初始化或运行时错误       |
| `screenshot`   | `(type?: 'png' \| 'jpeg', quality?: number) => string \| null` | 截图                     |
| `recreate`     | `() => Promise<void>`                                          | 销毁并重建查看器         |

## 2D 渲染组合式函数

提供一组组合式函数，将 Canvas2D 渲染函数包装为响应式接口。当 canvas ref 或选项变化时自动重新渲染。

### 可用函数

| 组合式函数               | 对应渲染函数          | 说明             |
| ------------------------ | --------------------- | ---------------- |
| `useRenderAvatar`        | `renderAvatar`        | 头像（头部正面） |
| `useRenderSkinFront`     | `renderSkinFront`     | 全身正面         |
| `useRenderSkinBack`      | `renderSkinBack`      | 全身背面         |
| `useRenderSkinSide`      | `renderSkinSide`      | 全身侧面         |
| `useRenderSkinIsometric` | `renderSkinIsometric` | 2.5D 等距视图    |
| `useRenderHalfBody`      | `renderHalfBody`      | 半身像           |
| `useRenderBigHead`       | `renderBigHead`       | 大头（Q 版）     |

### 用法

```vue
<script setup lang="ts">
import { ref } from "vue";
import { useRenderAvatar } from "@daidr/minecraft-skin-renderer/vue3";

const canvasRef = ref<HTMLCanvasElement | null>(null);
const skinUrl = ref("https://example.com/skin.png");

const { isRendering, error } = useRenderAvatar(canvasRef, () => ({
  skin: skinUrl.value,
  scale: 8,
}));
</script>

<template>
  <canvas ref="canvasRef" />
  <p v-if="isRendering">渲染中...</p>
  <p v-if="error">{{ error.message }}</p>
</template>
```

### 返回值

所有 2D 渲染组合式函数返回相同的类型：

| 属性          | 类型                        | 说明         |
| ------------- | --------------------------- | ------------ |
| `render`      | `() => Promise<void>`       | 手动触发渲染 |
| `isRendering` | `Ref<boolean>`              | 是否正在渲染 |
| `error`       | `ShallowRef<Error \| null>` | 渲染错误     |
