# Vue 3

本库提供了开箱即用的 Vue 3 集成，包括 `SkinViewer` 组件和一系列组合式函数。

[Vue Playground](https://play.vuejs.org/#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)

## 安装

确保你的项目已安装 Vue 3，然后从 `vue3` 子路径导入：

```ts
import { SkinViewer, useSkinViewer } from "@daidr/minecraft-skin-renderer/vue3";
```

::: tip 注册渲染器插件
使用 3D 组件或组合式函数前需注册渲染器插件。推荐通过 `plugins` prop 传入（如 `:plugins="[WebGLRendererPlugin]"`），也可以在应用入口处调用 `use(WebGLRendererPlugin)` 全局注册——全局注册后所有组件无需再传 `plugins`。
:::

## SkinViewer 组件

`SkinViewer` 是一个 Props 驱动的 3D 皮肤查看器组件，渲染一个承载 WebGL/WebGPU 画布的容器 `div`。所有选项通过 props 控制，响应式同步到查看器实例。

### 基本用法

```vue
<script setup lang="ts">
import { SkinViewer } from "@daidr/minecraft-skin-renderer/vue3";
import { WebGLRendererPlugin } from "@daidr/minecraft-skin-renderer/webgl";

const skinUrl = "https://example.com/skin.png";
</script>

<template>
  <SkinViewer
    :plugins="[WebGLRendererPlugin]"
    :skin="skinUrl"
    animation="walk"
    style="width: 400px; height: 600px"
  />
</template>
```

### Props

| Prop                 | 类型                            | 默认值   | 说明                                                   |
| -------------------- | ------------------------------- | -------- | ------------------------------------------------------ |
| `plugins`            | `AnyRegistrablePlugin[]`        | —        | 自动注册的插件列表                                     |
| `skin`               | `TextureSource`                 | —        | 皮肤纹理（URL、Blob、HTMLImageElement 或 ImageBitmap） |
| `cape`               | `TextureSource \| null`         | —        | 披风纹理，`null` 隐藏披风                              |
| `slim`               | `boolean`                       | `false`  | 是否使用纤细（3px）手臂模型                            |
| `backEquipment`      | `'none' \| 'cape' \| 'elytra'`  | `'none'` | 背部装备                                               |
| `preferredBackend`   | `'webgl' \| 'webgpu' \| 'auto'` | `'auto'` | 首选渲染后端                                           |
| `zoom`               | `number`                        | —        | 相机缩放距离                                           |
| `autoRotate`         | `boolean`                       | `false`  | 启用自动旋转                                           |
| `autoRotateSpeed`    | `number`                        | —        | 自动旋转速度                                           |
| `enableRotate`       | `boolean`                       | `true`   | 启用鼠标旋转控制                                       |
| `enableZoom`         | `boolean`                       | `true`   | 启用鼠标缩放控制                                       |
| `animation`          | `string \| null`                | —        | 播放的动画名称，`null` 停止动画                        |
| `animationSpeed`     | `number`                        | `1`      | 动画播放速度倍率                                       |
| `animationAmplitude` | `number`                        | `1`      | 动画运动幅度倍率                                       |
| `partsVisibility`    | `PartsVisibility`               | —        | 各部位图层可见性                                       |
| `panorama`           | `TextureSource \| null`         | —        | 全景图背景（需要 PanoramaPlugin）                      |
| `pixelRatio`         | `number`                        | —        | 设备像素比覆盖                                         |
| `antialias`          | `boolean`                       | `true`   | 启用抗锯齿                                             |
| `fov`                | `number`                        | —        | 相机视场角（度）                                       |

### 事件

| 事件    | 参数                   | 说明                     |
| ------- | ---------------------- | ------------------------ |
| `ready` | `(viewer: SkinViewer)` | 查看器初始化完成时触发   |
| `error` | `(error: Error)`       | 初始化或运行时出错时触发 |

### 暴露方法

通过模板引用（template ref）访问：

```vue
<script setup lang="ts">
import { ref } from "vue";
import { SkinViewer } from "@daidr/minecraft-skin-renderer/vue3";

const viewerRef = ref<InstanceType<typeof SkinViewer>>();

function takeScreenshot() {
  const dataUrl = viewerRef.value?.screenshot("png");
  // ...
}
</script>

<template>
  <SkinViewer ref="viewerRef" :skin="skinUrl" />
</template>
```

| 方法         | 类型                                                           | 说明             |
| ------------ | -------------------------------------------------------------- | ---------------- |
| `viewer`     | `ShallowRef<SkinViewer \| null>`                               | 查看器实例       |
| `backend`    | `ComputedRef<BackendType \| null>`                             | 当前渲染后端     |
| `screenshot` | `(type?: 'png' \| 'jpeg', quality?: number) => string \| null` | 截图             |
| `recreate`   | `() => Promise<void>`                                          | 销毁并重建查看器 |

## useSkinViewer

底层组合式函数，用于手动管理 SkinViewer 实例的创建和生命周期。适合需要更细粒度控制的场景。

### 基本用法

```vue
<script setup lang="ts">
import { ref } from "vue";
import { useSkinViewer } from "@daidr/minecraft-skin-renderer/vue3";
import { WebGLRendererPlugin } from "@daidr/minecraft-skin-renderer/webgl";

const skinUrl = ref("https://example.com/skin.png");

const { containerRef, viewer, isReady, error } = useSkinViewer(() => ({
  plugins: [WebGLRendererPlugin],
  skin: skinUrl.value,
  animation: "walk",
}));
</script>

<template>
  <div ref="containerRef" style="width: 400px; height: 600px" />
</template>
```

### 选项

传入一个返回 `UseSkinViewerOptions` 的 getter 函数。动态选项（`skin`、`cape`、`slim`、`zoom`、`animation` 等）会被自动监听并同步到查看器。创建时选项（`preferredBackend`、`antialias`、`fov` 等）仅在初始化时应用，修改后需调用 `recreate()` 重新初始化。

### 返回值

| 属性           | 类型                                                           | 说明                     |
| -------------- | -------------------------------------------------------------- | ------------------------ |
| `containerRef` | `Ref<HTMLElement \| null>`                                     | 绑定到容器元素的模板引用 |
| `viewer`       | `ShallowRef<SkinViewer \| null>`                               | 查看器实例               |
| `backend`      | `ComputedRef<BackendType \| null>`                             | 当前渲染后端             |
| `isReady`      | `Ref<boolean>`                                                 | 查看器是否已初始化       |
| `error`        | `ShallowRef<Error \| null>`                                    | 初始化或运行时错误       |
| `screenshot`   | `(type?: 'png' \| 'jpeg', quality?: number) => string \| null` | 截图                     |
| `recreate`     | `() => Promise<void>`                                          | 销毁并重建查看器         |

## 2D 渲染组合式函数

提供一组组合式函数，将 Canvas2D 渲染函数包装为响应式接口。当 canvas ref 或选项变化时自动重新渲染。

### 可用函数

| 组合式函数               | 对应渲染函数          | 说明             |
| ------------------------ | --------------------- | ---------------- |
| `useRenderAvatar`        | `renderAvatar`        | 头像（头部正面） |
| `useRenderSkinFront`     | `renderSkinFront`     | 全身正面         |
| `useRenderSkinBack`      | `renderSkinBack`      | 全身背面         |
| `useRenderSkinSide`      | `renderSkinSide`      | 全身侧面         |
| `useRenderSkinIsometric` | `renderSkinIsometric` | 2.5D 等距视图    |
| `useRenderHalfBody`      | `renderHalfBody`      | 半身像           |
| `useRenderBigHead`       | `renderBigHead`       | 大头（Q 版）     |

### 用法

```vue
<script setup lang="ts">
import { ref } from "vue";
import { useRenderAvatar } from "@daidr/minecraft-skin-renderer/vue3";

const canvasRef = ref<HTMLCanvasElement | null>(null);
const skinUrl = ref("https://example.com/skin.png");

const { isRendering, error } = useRenderAvatar(canvasRef, () => ({
  skin: skinUrl.value,
  scale: 8,
}));
</script>

<template>
  <canvas ref="canvasRef" />
  <p v-if="isRendering">渲染中...</p>
  <p v-if="error">{{ error.message }}</p>
</template>
```

### 返回值

所有 2D 渲染组合式函数返回相同的类型：

| 属性          | 类型                        | 说明         |
| ------------- | --------------------------- | ------------ |
| `render`      | `() => Promise<void>`       | 手动触发渲染 |
| `isRendering` | `Ref<boolean>`              | 是否正在渲染 |
| `error`       | `ShallowRef<Error \| null>` | 渲染错误     |
